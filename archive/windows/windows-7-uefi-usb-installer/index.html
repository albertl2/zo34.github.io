<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Create Windows 7 UEFI USB Installer Using Linux</title>
  <meta name="description" content="Do these things first:  Update your bios1. This is system specific. Google-fu is your best friend.  Install necessary packages: 7zip/p7zip, ms-sys, parted. F...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://albertlatham.com/windows/windows-7-uefi-usb-installer">
  <link rel="alternate" type="application/rss+xml" title="Student, Breaker, Maker" href="http://albertlatham.com/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Student, Breaker, Maker</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="/projects/">Projects</a>
          
        
          
          <a class="page-link" href="/resume/">Resume</a>
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Create Windows 7 UEFI USB Installer Using Linux</h1>
    <p class="post-meta">Apr 28, 2015</p>
  </header>

  <article class="post-content">
    <h1 id="do-these-things-first">Do these things first:</h1>
<ol>
  <li>Update your bios<sup id="fnref:3"><a href="#fn:3" class="footnote">1</a></sup>. This is system specific. Google-fu is your best friend.</li>
  <li>Install necessary packages: 7zip/p7zip, ms-sys, parted. For Arch Linux you can find these in the main repositories or in the <a href="https://aur.archlinux.org/">AUR</a>. For other distros, Google.</li>
  <li>Acquire Windows ISO. Either rip it from and installer disc or use other, more nefarious, means. Either way, Google-fu is your friend.</li>
  <li>Acquire system drivers. Your hardware manufacturer will (should) have these. For Asus hardware you can find them <a href="http://support.asus.com/Download/Options.aspx?SLanguage=en&amp;type=1">here</a>.</li>
</ol>

<h1 id="create-windows-install-usb1">Create Windows Install USB<sup id="fnref:1"><a href="#fn:1" class="footnote">2</a></sup></h1>
<p>Plug in your USB stick of choice. I found that 4Gb is not large enough and opted to use an 8Gb stick. Once plugged in, mount (if your system doesn’t auto mount for you) and back up everything that you want to keep. I use <code>cp -r</code> to move things on and off of USB storage.</p>

<pre><code class="language-bash">mount /dev/sdc1 ~/mount
cp -r ~/mount/* ~/backupdirectory
</code></pre>

<p>The locations listed above (<code>sdc1</code> and <code>~/mount</code>) are relative to my machine. The mount directory can be wherever you want and you can use <code>ls /dev | grep sd</code> to find your USB storage. Issue the command once before you plug your drive in and once after, then find the single new entry. (I’m sure there’s a command in linux that displays only what changed, but I don’t know it.)</p>

<p>Once copying has completed unmount your USB storage device.</p>

<pre><code class="language-bash">umount /dev/sdc1
</code></pre>

<p>Open up parted and set the disk label (to msdos) and partition (to ntfs).</p>

<pre><code class="language-bash">parted /dev/sdc
(parted) mklabel msdos
(parted) mkpart ntfs
</code></pre>

<p>Then, set the <code>boot</code> flag to on. Parted’s help menu states that the input should go something like this: <code>set NUMBER FLAG STATE</code>. Of specific interest is the <code>NUMBER</code> part of the command. This refers to the partition number of the storage device.</p>

<pre><code class="language-bash">(parted) set 1 boot on
</code></pre>

<p>Check to make sure the partition is what you need; use <code>p</code> in the Parted prompt to see what has been done to the storage device.</p>

<pre><code class="language-bash">(parted) p
Model:  USB DISK 2.0 (scsi)
Disk /dev/sdc: 7817MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags: 

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  7816MB  7815MB  primary  ntfs         boot
</code></pre>

<p>Once this is done, exit out of parted.</p>

<pre><code class="language-bash">(parted) q
</code></pre>

<p>Now, format the partition as NTFS using <code>mkntfs</code>. This will take a little while as the program will over write the entire partition with zeroes.</p>

<pre><code class="language-bash">mkntfs /dev/sdc1
</code></pre>

<p>Once this is complete, use 7zip to extract the contents of the windows ISO that was downloaded earlier. Optionally, you can <code>mkdir somedir</code> to put the extracted files into.</p>

<pre><code class="language-bash">7z x windows_iso.iso somedir/
</code></pre>

<p>Remount your USB device and copy all of the extracted files onto the USB storage device. This might take a while. Get a cup of coffee and browse Facebook for a while. Or, if you’re a good student of music, spend some time practicing. :)</p>

<pre><code class="language-bash">cp -r somedir/* ~/mount/
</code></pre>

<p>Unmount the drive again:</p>

<pre><code class="language-bash">umount /dev/sdc1
</code></pre>

<p>Finally, one step left. We need to setup the boot sector so that the USB device can be booted into. Note that the below command does not specify the partition sdc<code>1</code>, but just the drive <code>sdc</code>.</p>

<pre><code class="language-bash">ms-sys -7 /dev/sdc
</code></pre>

<h2 id="common-errors">Common Errors</h2>
<p>One issue that I have run into coninually is ruining the NTFS partition by not un-mounting the USB drive before removing it. Bad habits, I know. If this happens to you, you’ll see this when you try to <code>mount</code> the drive:</p>

<pre><code class="language-bash">mount: wrong fs type, bad option, bad superblock on /dev/sdb,
    missing codepage or helper program, or other error

    In some cases useful info is found in syslog - try
    dmesg | tail or so.
</code></pre>

<p>The fix<sup id="fnref:2"><a href="#fn:2" class="footnote">3</a></sup> is rather simple:</p>

<pre><code class="language-bash">ntfsfix /dev/sdc
</code></pre>

<p>This will diagnose the problems with the filesystem andin most cases fix them. If you are continually plagued by this report, jump back to parted and repeat the steps from there. I did this maybe four or five times before I got it right.</p>

<hr />

<p>If you’ve had other errors that you’ve run into, please just <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#097;&#108;&#098;&#101;&#114;&#116;&#046;&#108;&#097;&#116;&#104;&#097;&#109;&#064;&#097;&#103;&#103;&#105;&#101;&#109;&#097;&#105;&#108;&#046;&#117;&#115;&#117;&#046;&#101;&#100;&#117;">email</a> me and I’ll try to help you out.</p>

<h1 id="footnotes">Footnotes</h1>
<div class="footnotes">
  <ol>
    <li id="fn:3">
      <p>http://troywolf.com/?p=45 <a href="#fnref:3" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:1">
      <p>www.reddit.com/r/linuxquestions/comments/29wujx/making_a_windows_7_iso_on_a_linux_system/ciq0prj <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
    <li id="fn:2">
      <p>https://linuxacademy.com/blog/linux/ntfs-partition-repair-and-recovery-in-linux/ <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Student, Breaker, Maker</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Student, Breaker, Maker</li>
          <li><a href="mailto:albert.latham@aggiemail.usu.edu">albert.latham@aggiemail.usu.edu</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/zo34">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">zo34</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/albertlatham">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">albertlatham</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">Resume, CV, project log, and blog of aspiring engineer, Albert Latham. Also features troubleshooting tips and solutions for Albert's current projects and interests.
</p>
      </div>
    </div>

  </div>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-44756137-2', 'auto');
	  ga('send', 'pageview');

	</script>
</footer>


  </body>

</html>
